<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Etaria.net ‚Äì Masterplan</title>
<link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Outfit:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
<style>
:root{--bg:#060809;--surface:#0b0d11;--card:#0f1218;--border:#1a2030;--border-h:#253045;--amber:#f5a623;--amber-g:linear-gradient(135deg,#f5a623,#ff6b35);--red:#ef4444;--blue:#3b82f6;--green:#10b981;--purple:#a855f7;--cyan:#06b6d4;--text:#e2e8f4;--text-m:#7d8da4;--text-d:#3e506a;--radius:10px}
*{margin:0;padding:0;box-sizing:border-box}body{background:var(--bg);color:var(--text);font-family:'Outfit',sans-serif;line-height:1.6;min-height:100vh}
::-webkit-scrollbar{width:6px}::-webkit-scrollbar-track{background:var(--bg)}::-webkit-scrollbar-thumb{background:var(--border-h);border-radius:3px}
.login-overlay{position:fixed;inset:0;z-index:10000;background:rgba(6,8,9,.95);display:flex;align-items:center;justify-content:center}.login-overlay.hidden{display:none}
.login-box{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:2rem;width:340px;max-width:90vw;text-align:center}.login-box::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:var(--amber-g);border-radius:16px 16px 0 0}
.login-logo{font-family:'Space Mono',monospace;font-size:1.4rem;font-weight:700;color:var(--amber);margin-bottom:.2rem}.login-sub{color:var(--text-d);font-size:.75rem;margin-bottom:1.5rem}
.login-field{margin-bottom:.7rem}.login-field input{width:100%;padding:.65rem .9rem;background:var(--surface);border:1px solid var(--border);border-radius:8px;color:var(--text);font-size:.8rem;outline:none}.login-field input:focus{border-color:var(--amber)}
.login-btn{width:100%;padding:.75rem;background:var(--amber-g);border:none;border-radius:8px;color:#000;font-weight:700;cursor:pointer;margin-top:.3rem}.login-btn:disabled{opacity:.5}
.login-error{color:var(--red);font-size:.7rem;margin-top:.5rem;min-height:1rem}.guest-link{color:var(--text-d);font-size:.7rem;margin-top:.8rem;cursor:pointer}.guest-link:hover{color:var(--text-m)}
.topbar{position:fixed;top:0;left:0;right:0;z-index:500;background:rgba(6,8,9,.9);backdrop-filter:blur(12px);border-bottom:1px solid var(--border);padding:0 1.2rem;height:48px;display:flex;align-items:center;justify-content:space-between}
.topbar-logo{font-family:'Space Mono',monospace;font-size:.9rem;font-weight:700;color:var(--amber)}
.topbar-badge{font-family:'Space Mono',monospace;font-size:.5rem;padding:.15em .5em;border-radius:4px;margin-left:.5rem}.badge-admin{color:var(--amber);border:1px solid rgba(245,166,35,.3);background:rgba(245,166,35,.1)}.badge-viewer{color:var(--text-d);border:1px solid var(--border)}
.topbar-right{display:flex;align-items:center;gap:.6rem}.btn-sm{font-size:.65rem;padding:.35rem .7rem;border-radius:5px;border:1px solid var(--border);background:var(--surface);color:var(--text-m);cursor:pointer}.btn-sm:hover{border-color:var(--amber);color:var(--text)}
.edit-bar{position:fixed;bottom:0;left:0;right:0;z-index:500;background:rgba(245,166,35,.1);border-top:2px solid var(--amber);padding:.5rem;display:none;align-items:center;justify-content:center;gap:.8rem}.edit-bar.show{display:flex}.edit-bar span{font-family:'Space Mono',monospace;font-size:.68rem;color:var(--amber);font-weight:700}
.app{max-width:850px;margin:0 auto;padding:68px 1.2rem 4rem}
.hero{text-align:center;padding:1.5rem 0 1rem}.hero h1{font-size:1.8rem;font-weight:900;background:linear-gradient(135deg,#fff,var(--amber));-webkit-background-clip:text;-webkit-text-fill-color:transparent}.hero p{color:var(--text-d);font-size:.72rem;margin-top:.3rem}
.nav-wrap{position:sticky;top:48px;z-index:100;background:rgba(6,8,9,.95);border-bottom:1px solid var(--border);margin:0 -1.2rem;padding:0 1.2rem}.nav-inner{display:flex;overflow-x:auto}.nav-inner::-webkit-scrollbar{display:none}
.nav-btn{font-size:.68rem;font-weight:600;color:var(--text-d);background:none;border:none;padding:.7rem .9rem;cursor:pointer;border-bottom:2px solid transparent}.nav-btn:hover{color:var(--text-m)}.nav-btn.active{color:var(--amber);border-bottom-color:var(--amber)}
.prog-wrap{margin:1rem 0;background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:.8rem 1rem}.prog-top{display:flex;justify-content:space-between;margin-bottom:.4rem}.prog-top h3{font-size:.7rem}.prog-pct{font-family:'Space Mono',monospace;font-size:.7rem;color:var(--amber)}
.prog-bar{height:5px;background:var(--surface);border-radius:3px;overflow:hidden}.prog-fill{height:100%;background:var(--amber-g);width:0%;transition:width .5s}
.prog-stats{font-family:'Space Mono',monospace;font-size:.52rem;color:var(--text-d);margin-top:.3rem}
.sec{margin-top:1rem;display:none}.sec.vis{display:block}
.sec-head{display:flex;align-items:center;gap:.5rem;margin-bottom:.5rem}.sec-head h2{font-size:.85rem;font-weight:800}.sec-desc{color:var(--text-m);font-size:.7rem;margin-bottom:.7rem;line-height:1.5}
.step{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);margin-bottom:.5rem;overflow:hidden}.step:hover{border-color:var(--border-h)}.step.done{opacity:.4}.step.done .step-num{background:var(--green);color:#000}
.step-header{display:flex;align-items:center;gap:.6rem;padding:.75rem;cursor:pointer}
.step-num{width:24px;height:24px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-family:'Space Mono',monospace;font-size:.6rem;font-weight:700;flex-shrink:0}
.step-num.kritisch{background:var(--red);color:#fff}.step-num.hoch{background:var(--amber);color:#000}.step-num.mittel{background:var(--blue);color:#fff}.step-num.niedrig{background:var(--text-d);color:#fff}
.step-info{flex:1}.step-title{font-size:.78rem;font-weight:700}.step-cat{font-family:'Space Mono',monospace;font-size:.5rem;color:var(--text-d)}
.step-check{width:18px;height:18px;border:2px solid var(--border-h);border-radius:4px;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:.5rem;flex-shrink:0}.step-check:hover{border-color:var(--amber)}.step-check.on{background:var(--green);border-color:var(--green);color:#000}
.step-del{width:18px;height:18px;border-radius:50%;border:1px solid var(--border);background:var(--surface);color:var(--text-d);font-size:.5rem;cursor:pointer;display:none;align-items:center;justify-content:center;margin-left:.3rem}.step-del:hover{border-color:var(--red);color:var(--red)}
body.edit-mode .step-del{display:flex}
.step-toggle{font-size:.5rem;color:var(--text-d);margin-left:.2rem}
.step-body{max-height:0;overflow:hidden;transition:max-height .3s}.step-body.open{max-height:500px}
.step-content{padding:0 .75rem .75rem;border-top:1px solid var(--border)}
.step-why{background:rgba(239,68,68,.07);border:1px solid rgba(239,68,68,.15);border-radius:6px;padding:.5rem .65rem;margin:.6rem 0}.step-why b{font-size:.55rem;color:var(--red)}.step-why p{font-size:.65rem;color:var(--text-m);margin-top:.2rem;line-height:1.45}
.step-todo{background:var(--surface);border-radius:6px;padding:.6rem}.step-todo b{font-size:.55rem;color:var(--green)}
.todo-item{font-size:.65rem;color:var(--text);padding:.2rem 0;display:flex;gap:.4rem;line-height:1.4}.todo-item::before{content:'‚Üí';color:var(--amber)}
.price-table{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);overflow:hidden;margin-bottom:.7rem}
.price-header{background:var(--surface);padding:.45rem .75rem;font-size:.62rem;font-weight:700;border-bottom:1px solid var(--border);display:flex;justify-content:space-between}
.price-row{display:flex;padding:.35rem .75rem;border-bottom:1px solid var(--border);font-size:.65rem}.price-row:last-child{border:none}
.price-item{flex:1}.price-cost{font-family:'Space Mono',monospace;color:var(--green);font-weight:600;min-width:70px;text-align:right}.price-note{color:var(--text-d);font-size:.58rem;min-width:60px;text-align:right}
.card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:.75rem;margin-bottom:.5rem}
.card-head{display:flex;align-items:center;gap:.4rem;margin-bottom:.25rem}.card h4{font-size:.75rem;font-weight:700}.card p{font-size:.65rem;color:var(--text-m);line-height:1.4}
.badge-ok{font-size:.45rem;padding:.1em .3em;border-radius:3px;background:rgba(16,185,129,.12);color:var(--green);border:1px solid rgba(16,185,129,.2);margin-left:.2rem}
.badge-warn{font-size:.45rem;padding:.1em .3em;border-radius:3px;background:rgba(245,166,35,.1);color:var(--amber);border:1px solid rgba(245,166,35,.2);margin-left:.2rem}
.badge-bad{font-size:.45rem;padding:.1em .3em;border-radius:3px;background:rgba(239,68,68,.1);color:var(--red);border:1px solid rgba(239,68,68,.2);margin-left:.2rem}
.tags{display:flex;gap:.2rem;flex-wrap:wrap;margin-top:.35rem}.tag{font-family:'Space Mono',monospace;font-size:.45rem;padding:.1em .3em;border-radius:3px;border:1px solid var(--border);color:var(--text-d)}.tag.ok{border-color:rgba(16,185,129,.3);color:var(--green)}.tag.warn{border-color:rgba(239,68,68,.3);color:var(--red)}
.timeline{padding-left:1.6rem;position:relative}.timeline::before{content:'';position:absolute;left:8px;top:0;bottom:0;width:2px;background:linear-gradient(var(--amber),var(--border))}
.phase{position:relative;margin-bottom:.7rem}.phase-dot{position:absolute;left:-1.6rem;top:.6rem;width:18px;height:18px;border-radius:50%;border:2px solid var(--border);background:var(--bg);display:flex;align-items:center;justify-content:center;font-family:'Space Mono',monospace;font-size:.45rem;font-weight:700}.phase.done .phase-dot{background:var(--green);border-color:var(--green);color:#000}
.phase-card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:.75rem}
.phase-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:.2rem}.phase-title{font-size:.75rem;font-weight:700}.phase-time{font-family:'Space Mono',monospace;font-size:.48rem;color:var(--text-d);background:var(--surface);padding:.1em .35em;border-radius:3px}
.phase-goal{font-size:.62rem;color:var(--amber);font-weight:600;margin-bottom:.35rem}
.phase-text{font-size:.65rem;color:var(--text-m);line-height:1.4;margin-bottom:.4rem}
.pcheck{display:flex;align-items:center;gap:.3rem;font-size:.62rem;color:var(--text-m);cursor:pointer;padding:.12rem 0}.pcheck:hover{color:var(--text)}.pcheck.on{color:var(--text-d);text-decoration:line-through}
.pcheck-box{width:13px;height:13px;border:1.5px solid var(--border-h);border-radius:3px;display:flex;align-items:center;justify-content:center;font-size:.42rem;flex-shrink:0}.pcheck.on .pcheck-box{background:var(--green);border-color:var(--green);color:#000}
.toast{position:fixed;bottom:60px;left:50%;transform:translateX(-50%) translateY(20px);background:var(--green);color:#000;font-family:'Space Mono',monospace;font-size:.62rem;font-weight:700;padding:.4rem .9rem;border-radius:5px;opacity:0;transition:.3s;z-index:600}.toast.show{opacity:1;transform:translateX(-50%) translateY(0)}.toast.err{background:var(--red);color:#fff}
.spinner{width:12px;height:12px;border:2px solid var(--text-d);border-top-color:var(--amber);border-radius:50%;animation:spin .5s linear infinite;display:inline-block}@keyframes spin{to{transform:rotate(360deg)}}
.dot{width:6px;height:6px;border-radius:50%;background:var(--green);display:inline-block;margin-right:.2rem}
.info{background:rgba(59,130,246,.07);border:1px solid rgba(59,130,246,.15);border-radius:6px;padding:.55rem .7rem;margin-bottom:.7rem}.info p{font-size:.65rem;color:var(--text-m);line-height:1.45}.info b{color:var(--blue)}
</style>
</head>
<body>
<div class="login-overlay" id="lo"><div class="login-box"><div class="login-logo">ETARIA</div><div class="login-sub">Masterplan</div><div id="lf"><div class="login-field"><input id="le" placeholder="E-Mail"></div><div class="login-field"><input id="lp" type="password" placeholder="Passwort"></div><button class="login-btn" id="lb" onclick="login()">Anmelden</button><div class="login-error" id="lerr"></div></div><div class="guest-link" onclick="guest()">Als Gast ansehen ‚Üí</div></div></div>
<div class="topbar" id="tb" style="display:none"><div style="display:flex;align-items:center"><span class="topbar-logo">ETARIA</span><span class="topbar-badge" id="badge">ADMIN</span><span id="sync" style="margin-left:.4rem"></span></div><div class="topbar-right"><button class="btn-sm" id="ebtn" style="display:none" onclick="toggleEdit()">‚úèÔ∏è Edit</button><button class="btn-sm" onclick="logout()">Logout</button></div></div>
<div class="edit-bar" id="ebar"><span>‚úèÔ∏è EDIT MODE</span><button class="btn-sm" onclick="toggleEdit()">Fertig</button></div>
<div class="toast" id="toast"></div>
<div class="app" id="app" style="display:none">
<header class="hero"><h1>Etaria Masterplan</h1><p>Schritt f√ºr Schritt zum erfolgreichen Server</p></header>
<nav class="nav-wrap"><div class="nav-inner"><button class="nav-btn active" data-t="leitfaden">üìã Leitfaden</button><button class="nav-btn" data-t="preise">üí∞ Preise</button><button class="nav-btn" data-t="reise">üó∫Ô∏è Spielerreise</button><button class="nav-btn" data-t="status">üìä Status</button></div></nav>
<div class="prog-wrap"><div class="prog-top"><h3>Fortschritt</h3><span class="prog-pct" id="pct">0%</span></div><div class="prog-bar"><div class="prog-fill" id="fill"></div></div><div class="prog-stats"><span id="done">0</span> erledigt ¬∑ <span id="total">0</span> Aufgaben</div></div>
<div id="root"></div>
</div>
<script>
firebase.initializeApp({apiKey:"AIzaSyD9VRhfeOiCT3hgPw1rSi59CM3IZpvd-c8",authDomain:"etaria-masterplan.firebaseapp.com",projectId:"etaria-masterplan"});
const auth=firebase.auth(),db=firebase.firestore(),$=id=>document.getElementById(id);
let user=null,admin=false,edit=false,tab='leitfaden',S={done:{},checks:{},open:{},del:[]};

const L=[
{id:"s1",n:1,p:"kritisch",t:"Starthaus deaktivieren",c:"Server",w:"Starthaus h√§lt Spieler von der echten Welt fern. Sie bauen dort, haben keinen Grund rauszugehen. Kein Survival-Gef√ºhl.",todo:["starthaus-1.0.jar umbenennen zu .disabled","Server neustarten","Testen: Neue Spieler spawnen in Survival"]},
{id:"s2",n:2,p:"kritisch",t:"Starter-Kit einrichten",c:"Gameplay",w:"Ohne Starthaus brauchen Spieler sofort Ausr√ºstung, sonst sterben sie.",todo:["Kit: Holzschwert, 16 Steak, 32 Cobblestone","Bei erstem Join automatisch geben","10 Min PvP-Schutz optional"]},
{id:"s3",n:3,p:"kritisch",t:"Munitions-Shop",c:"Wirtschaft",w:"Waffen existieren aber keine Muni-Quelle! Bei 200-300$/h m√ºssen Preise g√ºnstig sein.",todo:["NPC 'Waffenh√§ndler' am Spawn","Pistole: 0.50$/Mag, SMG: 1$, Gewehr: 2$","Sniper: 5$/Mag, RPG: 25$/Rakete"]},
{id:"s4",n:4,p:"kritisch",t:"Kill-Belohnung",c:"PvP",w:"PvP ohne Reward = Griefing. Spieler brauchen Grund zu k√§mpfen.",todo:["Kill = 25-75$ zuf√§llig + 1 Fragment","Anti-Farm: Gleicher Spieler 1x/30min","Kill-Nachricht im Chat"]},
{id:"s5",n:5,p:"hoch",t:"Daily Login Streak",c:"Retention",w:"T√§glicher Login-Grund. Streak pausiert, resettet nicht.",todo:["Tag 1: 25$, Tag 3: 75$+Frag","Tag 7: 200$+3 Frags, Tag 14: 500$+Key","Bei Verpassung: Pausiert, nicht reset"]},
{id:"s6",n:6,p:"hoch",t:"Airdrops",c:"Events",w:"Bringt Spieler zusammen, erzeugt PvP-Hotspots.",todo:["Alle 2h wenn 3+ online","3 Min Warnung mit Koordinaten","Loot: 50-150$, Magazine, Fragmente"]},
{id:"s7",n:7,p:"hoch",t:"Waffen-Reparatur",c:"Wirtschaft",w:"Waffen gehen kaputt, keine Reparatur = Frust.",todo:["NPC 'Schmied' am Spawn","Pistole: 10$+5 Eisen, Gewehr: 25$+10 Eisen","Sniper: 50$+5 Gold, RPG: 100$+10 Gold"]},
{id:"s8",n:8,p:"mittel",t:"Schwarzmarkt",c:"Wirtschaft",w:"Wechselndes Angebot = FOMO, Login-Grund.",todo:["Angebot wechselt alle 4h","4 seltene Items, hohe Preise","Timer sichtbar"]},
{id:"s9",n:9,p:"mittel",t:"Bounty-System",c:"PvP",w:"Kopfgeld erzeugt Rivalit√§ten.",todo:["/bounty [spieler] [betrag]","Ab 200$ Broadcast","Killer bekommt alles"]},
{id:"s10",n:10,p:"mittel",t:"Claim-Wartung",c:"Wirtschaft",w:"Inaktive blockieren Land. Code existiert in DB!",todo:["Upkeep aktivieren: 5$/Tag pro Claim","7 Tage Schonfrist","Danach Claim frei"]},
{id:"s11",n:11,p:"niedrig",t:"Job-Abh√§ngigkeiten",c:"Wirtschaft",w:"Niemand braucht andere Spieler aktuell.",todo:["Bergarbeiter: Einziger der schmelzt","Holzf√§ller: Drogen-Equipment craften","Fischer: Seltene Komponenten"]},
{id:"s12",n:12,p:"niedrig",t:"Drogen-Konsum",c:"Content",w:"Cannabis ohne Effekt = langweilig.",todo:["Cannabis: Speed+St√§rke 60s","PvP-Vorteil durch Drogen"]}
];

const P={
muni:{t:"üî´ Munition",n:"G√ºnstig!",i:[{a:"Pistole (30)",b:"0.50$",c:""},{a:"SMG (40)",b:"1.00$",c:""},{a:"Gewehr (30)",b:"2.00$",c:""},{a:"Shotgun (16)",b:"1.50$",c:""},{a:"Sniper (8)",b:"5.00$",c:""},{a:"RPG",b:"25.00$",c:"Selten"},{a:"Granate",b:"10.00$",c:""}]},
rep:{t:"üîß Reparatur",n:"Schmied-NPC",i:[{a:"Pistole",b:"10$ + 5 Eisen",c:""},{a:"SMG",b:"15$ + 8 Eisen",c:""},{a:"Gewehr",b:"25$ + 10 Eisen",c:""},{a:"Sniper",b:"50$ + 5 Gold",c:""},{a:"RPG",b:"100$ + 10 Gold",c:""}]},
daily:{t:"üî• Daily Streak",n:"Jeden Tag",i:[{a:"Tag 1",b:"25$",c:""},{a:"Tag 3",b:"75$ + 1 Frag",c:""},{a:"Tag 7",b:"200$ + 3 Frags",c:""},{a:"Tag 14",b:"500$ + Key",c:""},{a:"Tag 30",b:"1.000$ + Titel",c:""}]},
drop:{t:"üì¶ Airdrops",n:"Alle 2h",i:[{a:"Normal",b:"50-150$ + Mags",c:""},{a:"Selten (1x/Tag)",b:"300$ + Waffe",c:""},{a:"Legend√§r",b:"1.000$ + Rare",c:"1x/Woche"}]},
kill:{t:"üíÄ Kills",n:"PvP lohnt sich",i:[{a:"Spieler-Kill",b:"25-75$ + 1 Frag",c:""},{a:"Bounty-Kill",b:"Kopfgeld + Normal",c:""},{a:"Anti-Farm",b:"1x/30min",c:""}]}
};

const ST=[
{e:"‚öíÔ∏è",t:"Jobs",s:"partial",d:"3 Jobs ok, aber keine Abh√§ngigkeiten",tags:["ok:3 Jobs","warn:Keine Abh√§ngigkeit"]},
{e:"üî´",t:"Waffen",s:"bad",d:"21 Waffen, KEINE Muni-Quelle!",tags:["ok:21 Waffen","warn:Keine Muni","warn:Keine Rep"]},
{e:"üé∞",t:"Crates",s:"ok",d:"Funktioniert mit Fragmenten",tags:["ok:Funktioniert"]},
{e:"üåø",t:"Cannabis",s:"partial",d:"Anbau ok, kein Konsum-Effekt",tags:["ok:Anbau","warn:Kein Konsum"]},
{e:"‚öîÔ∏è",t:"Clans",s:"partial",d:"Existiert, Upkeep deaktiviert",tags:["ok:Clan-Bank","warn:Kein Upkeep"]},
{e:"üèóÔ∏è",t:"Claims",s:"partial",d:"Schutz ok, keine Wartung",tags:["ok:Schutz","warn:Keine Wartung"]},
{e:"üíÄ",t:"PvP",s:"bad",d:"Full Loot, KEIN Kill-Reward!",tags:["ok:Combat-Tag","warn:Kein Reward"]},
{e:"üì±",t:"Sonstiges",s:"ok",d:"Handy, NPCs, Tutorial ok",tags:["ok:Solide"]}
];

const PH=[
{n:1,t:"Ankunft",ti:"0-30 Min",g:"Server verstehen, erste Waffe",tx:"Spawn ‚Üí Kit ‚Üí Tutorial ‚Üí Survival. KEIN Starthaus!",ck:[{t:"Starter-Kit ok",k:"r1a"},{t:"Tutorial erkl√§rt",k:"r1b"},{t:"Erste Waffe",k:"r1c"}]},
{n:2,t:"Aufbau",ti:"Tag 1-3",g:"Base, Job leveln, erste Crate",tx:"Claim ‚Üí Base ‚Üí Job ‚Üí Cannabis ‚Üí Fragmente ‚Üí Crate",ck:[{t:"Claim-System klar",k:"r2a"},{t:"Geld fair",k:"r2b"},{t:"Erste Crate",k:"r2c"}]},
{n:3,t:"Spezialisierung",ti:"Tag 3-7",g:"Enchants, Clan, Nische",tx:"KRITISCH! Hier gehen die meisten. Braucht Airdrops, Schwarzmarkt.",ck:[{t:"Enchants verf√ºgbar",k:"r3a"},{t:"Airdrop erlebt",k:"r3b"},{t:"Daily l√§uft",k:"r3c"}]},
{n:4,t:"Langzeit",ti:"Woche 2+",g:"Rivalit√§ten, t√§gliche Gr√ºnde",tx:"Hier stirbt der Server! Braucht Kill-Rewards, Bounty, Events.",ck:[{t:"Kill-Rewards",k:"r4a"},{t:"Bounty aktiv",k:"r4b"},{t:"Events laufen",k:"r4c"}]}
];

function login(){
  const b=$('lb');b.disabled=true;b.innerHTML='<span class="spinner"></span>';$('lerr').textContent='';
  auth.signInWithEmailAndPassword($('le').value,$('lp').value).catch(e=>{$('lerr').textContent='‚ùå Fehler';b.disabled=false;b.textContent='Anmelden'});
}
function guest(){user='Gast';admin=false;enter()}
function logout(){auth.signOut();location.reload()}
auth.onAuthStateChanged(u=>{if(u){user=u.email.split('@')[0];admin=true;enter()}});

function enter(){
  $('lo').classList.add('hidden');$('app').style.display='block';$('tb').style.display='flex';
  $('badge').textContent=admin?'ADMIN':'GAST';$('badge').className='topbar-badge '+(admin?'badge-admin':'badge-viewer');
  $('ebtn').style.display=admin?'inline':'none';
  load();
}

async function load(){
  $('sync').innerHTML='<span class="spinner"></span>';
  try{const d=await db.collection('mp').doc('s').get();if(d.exists)S={done:{},checks:{},open:{},del:[],...d.data()};$('sync').innerHTML='<span class="dot"></span>'}
  catch(e){$('sync').innerHTML='<span style="color:var(--red)">‚ö†Ô∏è</span>'}
  render();
}
async function save(){try{await db.collection('mp').doc('s').set(S)}catch(e){}}
db.collection('mp').doc('s').onSnapshot(d=>{if(d.exists){S={done:{},checks:{},open:{},del:[],...d.data()};render()}});

function toggleEdit(){edit=!edit;document.body.classList.toggle('edit-mode',edit);$('ebar').classList.toggle('show',edit);$('ebtn').textContent=edit?'üëÅÔ∏è':'‚úèÔ∏è Edit'}
function toast(m,e){const t=$('toast');t.textContent=m;t.className='toast show'+(e?' err':'');setTimeout(()=>t.className='toast',1800)}

function render(){
  const r=$('root');
  r.innerHTML=[rLeit(),rPreise(),rReise(),rStatus()].join('');
  document.querySelectorAll('.sec').forEach(s=>s.classList.toggle('vis',s.dataset.s===tab));
  prog();bind();
}

function rLeit(){
  const steps=L.filter(s=>!S.del.includes(s.id));
  return '<div class="sec vis" data-s="leitfaden"><div class="sec-head"><h2>üìã Leitfaden</h2></div><p class="sec-desc">Arbeite von oben nach unten. Kritische zuerst!</p><div class="info"><p><b>Ziel:</b> Spieler gewinnen UND halten. Jeder Schritt l√∂st ein konkretes Problem.</p></div>'+steps.map(s=>{
    const d=S.done[s.id],o=S.open[s.id];
    return '<div class="step'+(d?' done':'')+'" data-id="'+s.id+'"><div class="step-header"><div class="step-num '+s.p+'">'+(d?'‚úì':s.n)+'</div><div class="step-info"><div class="step-title">'+s.t+'</div><div class="step-cat">'+s.c+' ¬∑ '+s.p.toUpperCase()+'</div></div><div class="step-check'+(d?' on':'')+'" data-done="'+s.id+'">'+(d?'‚úì':'')+'</div><button class="step-del" data-del="'+s.id+'">‚úï</button><span class="step-toggle">'+(o?'‚ñ≤':'‚ñº')+'</span></div><div class="step-body'+(o?' open':'')+'"><div class="step-content"><div class="step-why"><b>‚ö†Ô∏è WARUM?</b><p>'+s.w+'</p></div><div class="step-todo"><b>‚úÖ TO-DO</b>'+s.todo.map(t=>'<div class="todo-item">'+t+'</div>').join('')+'</div></div></div></div>'}).join('')+'</div>';
}

function rPreise(){
  return '<div class="sec" data-s="preise"><div class="sec-head"><h2>üí∞ Preise</h2></div><p class="sec-desc">Basierend auf 200-300$/h Verdienst. Muni MUSS billig sein!</p>'+Object.values(P).map(p=>'<div class="price-table"><div class="price-header"><span>'+p.t+'</span><span style="color:var(--text-d)">'+p.n+'</span></div>'+p.i.map(i=>'<div class="price-row"><span class="price-item">'+i.a+'</span><span class="price-cost">'+i.b+'</span><span class="price-note">'+i.c+'</span></div>').join('')+'</div>').join('')+'</div>';
}

function rReise(){
  return '<div class="sec" data-s="reise"><div class="sec-head"><h2>üó∫Ô∏è Spielerreise</h2></div><p class="sec-desc">So erlebt ein neuer Spieler deinen Server. Phase 3-4 kritisch!</p><div class="timeline">'+PH.map(p=>{
    const allDone=p.ck.every(c=>S.checks[c.k]);
    return '<div class="phase'+(allDone?' done':'')+'"><div class="phase-dot">'+(allDone?'‚úì':p.n)+'</div><div class="phase-card"><div class="phase-top"><span class="phase-title">'+p.t+'</span><span class="phase-time">'+p.ti+'</span></div><div class="phase-goal">üéØ '+p.g+'</div><div class="phase-text">'+p.tx+'</div>'+p.ck.map(c=>{const on=S.checks[c.k];return '<label class="pcheck'+(on?' on':'')+'" data-ck="'+c.k+'"><span class="pcheck-box">'+(on?'‚úì':'')+'</span>'+c.t+'</label>'}).join('')+'</div></div>'}).join('')+'</div></div>';
}

function rStatus(){
  const badge=s=>s==='ok'?'<span class="badge-ok">‚úì OK</span>':s==='partial'?'<span class="badge-warn">‚óê</span>':'<span class="badge-bad">‚úó</span>';
  return '<div class="sec" data-s="status"><div class="sec-head"><h2>üìä Status</h2></div><p class="sec-desc">Was funktioniert und was nicht.</p>'+ST.map(s=>'<div class="card"><div class="card-head"><span>'+s.e+'</span><h4>'+s.t+' '+badge(s.s)+'</h4></div><p>'+s.d+'</p><div class="tags">'+s.tags.map(t=>'<span class="tag '+(t.startsWith('ok')?'ok':'warn')+'">'+t.replace('ok:','‚úì ').replace('warn:','‚ö†Ô∏è ')+'</span>').join('')+'</div></div>').join('')+'</div>';
}

function bind(){
  document.querySelectorAll('.step-header').forEach(h=>h.onclick=e=>{
    if(e.target.classList.contains('step-check')||e.target.classList.contains('step-del'))return;
    const id=h.parentElement.dataset.id,body=h.nextElementSibling;
    body.classList.toggle('open');h.querySelector('.step-toggle').textContent=body.classList.contains('open')?'‚ñ≤':'‚ñº';
    S.open[id]=body.classList.contains('open');save();
  });
  document.querySelectorAll('.step-check').forEach(c=>c.onclick=e=>{e.stopPropagation();if(!admin)return;S.done[c.dataset.done]=!S.done[c.dataset.done];save();toast(S.done[c.dataset.done]?'‚úì Erledigt':'Zur√ºckgesetzt')});
  document.querySelectorAll('.step-del').forEach(d=>d.onclick=e=>{e.stopPropagation();if(!admin||!confirm('L√∂schen?'))return;S.del.push(d.dataset.del);save();toast('Gel√∂scht')});
  document.querySelectorAll('.pcheck').forEach(c=>c.onclick=()=>{if(!admin)return;S.checks[c.dataset.ck]=!S.checks[c.dataset.ck];save()});
  document.querySelectorAll('.nav-btn').forEach(b=>b.onclick=()=>{tab=b.dataset.t;document.querySelectorAll('.nav-btn').forEach(x=>x.classList.remove('active'));b.classList.add('active');document.querySelectorAll('.sec').forEach(s=>s.classList.toggle('vis',s.dataset.s===tab))});
}

function prog(){
  const steps=L.filter(s=>!S.del.includes(s.id)),checks=PH.reduce((a,p)=>a+p.ck.length,0);
  const doneS=steps.filter(s=>S.done[s.id]).length,doneC=Object.keys(S.checks).filter(k=>S.checks[k]).length;
  const d=doneS+doneC,t=steps.length+checks,p=t?Math.round(d/t*100):0;
  $('pct').textContent=p+'%';$('fill').style.width=p+'%';$('done').textContent=d;$('total').textContent=t;
}

$('lp').onkeydown=e=>{if(e.key==='Enter')login()};
render();
</script>
</body>
</html>
